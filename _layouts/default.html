<!DOCTYPE html>
<html lang="en" data-baseurl="{{ site.baseurl }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: https://www.google-analytics.com; font-src 'self' data:; connect-src 'self' https://api.github.com https://www.google-analytics.com https://analytics.google.com https://region1.google-analytics.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';"">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta name="author" content="Matt Griffin">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS Feed" href="{{ site.baseurl }}/feed.xml">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/main.css">
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/analytics.css">
</head>
<body>
    <!-- Skip navigation link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Theme toggle button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light theme">
        <span class="theme-toggle-icon" id="theme-icon">ğŸŒ™</span>
        <span id="theme-text">Dark</span>
    </button>
    
    <h1><a href="{{ site.baseurl }}/" class="site-title-link">{{ site.title }}</a></h1>
    
    {% include navigation.html %}
    
    <!-- Mobile search icon (mobile only) -->
    <span class="mobile-search" title="Search" onclick="toggleSearch()">ğŸ”</span>
    
    <!-- Hamburger menu button (mobile only) -->
    <button class="hamburger-menu" aria-label="Toggle navigation menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>
    
    <!-- Mobile overlay -->
    <div class="sidebar-overlay"></div>
    
    <!-- Combined mobile menu -->
    <div class="combined-menu">
        <!-- Main Navigation Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Main Navigation</h3>
            <ul class="menu-items">
                <li><a href="{{ site.baseurl }}/" {% if page.url == "/" or page.url == "/index.html" %}class="active"{% endif %}><span class="menu-icon">ğŸ </span>Home</a></li>
                {% assign sorted_pages = site.pages | sort: 'title' %}
                {% for page_item in sorted_pages %}
                    {% if page_item.title and page_item.title != "Home" and page_item.title != "Search" %}
                        <li><a href="{{ site.baseurl }}{{ page_item.url }}" {% if page.url == page_item.url %}class="active"{% endif %}>
                            <span class="menu-icon">
                                {% if page_item.title == "About Me" %}ğŸ‘¤
                                {% elsif page_item.title == "Contact" %}ğŸ“§
                                {% elsif page_item.title == "Archive" %}ğŸ“
                                {% elsif page_item.title == "Category" %}ğŸ·ï¸
                                {% else %}ğŸ“„{% endif %}
                            </span>{{ page_item.title }}
                        </a></li>
                    {% endif %}
                {% endfor %}
                {% if site.posts.size > 0 %}
                    <li><a href="{{ site.baseurl }}/posts/" {% if page.url contains '/posts/' or page.layout == 'post' %}class="active"{% endif %}><span class="menu-icon">ğŸ“</span>Posts</a></li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Categories Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Categories</h3>
            <ul class="menu-items">
                {% assign categories = site.posts | map: 'categories' | join: ',' | split: ',' | uniq | sort %}
                {% for category in categories limit: 5 %}
                    {% if category != "" %}
                        {% assign category_posts = site.posts | where: 'categories', category %}
                        <li><a href="{{ site.baseurl }}/category/{{ category | slugify }}/">
                            <span class="menu-icon">ğŸ·ï¸</span>{{ category | capitalize }}
                            <span class="menu-count">{{ category_posts.size }}</span>
                        </a></li>
                    {% endif %}
                {% endfor %}
                {% if categories.size > 5 %}
                    <li><a href="{{ site.baseurl }}/category/"><span class="menu-icon">ğŸ“‚</span>View All Categories</a></li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Archives Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Archives</h3>
            <ul class="menu-items">
                {% assign years = "" | split: "" %}
                {% for post in site.posts %}
                    {% assign post_year = post.date | date: "%Y" %}
                    {% unless years contains post_year %}
                        {% assign years = years | push: post_year %}
                    {% endunless %}
                {% endfor %}
                {% assign years = years | sort | reverse %}
                {% for year in years limit: 5 %}
                    {% assign count = 0 %}
                    {% for post in site.posts %}
                        {% assign post_year = post.date | date: "%Y" %}
                        {% if post_year == year %}
                            {% assign count = count | plus: 1 %}
                        {% endif %}
                    {% endfor %}
                    {% if count > 0 %}
                        <li><a href="{{ site.baseurl }}/archive/{{ year }}/">
                            <span class="menu-icon">ğŸ“…</span>{{ year }}
                            <span class="menu-count">{{ count }}</span>
                        </a></li>
                    {% endif %}
                {% endfor %}
                {% if years.size > 5 %}
                    <li><a href="{{ site.baseurl }}/archive/"><span class="menu-icon">ğŸ“</span>View All Archives</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    
    <div class="site-container">
        <main class="main-content" id="main-content">
            {% unless page.url == "/" %}
                {% include breadcrumbs.html %}
            {% endunless %}
            {{ content }}
        </main>
        
        {% include sidebar.html %}
    </div>
    
    {% include footer.html %}
    
    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <span class="close">&times;</span>
        <img id="modalImage" src="" alt="">
    </div>
    
    <!-- Scripts -->
    <script src="{{ site.baseurl }}/assets/js/utils.js"></script>
    <script src="{{ site.baseurl }}/assets/js/search.js"></script>
    <script src="{{ site.baseurl }}/assets/js/modal.js"></script>
    <script src="{{ site.baseurl }}/assets/js/hamburger.js"></script>
    <script src="{{ site.baseurl }}/assets/js/pagination.js"></script>
    <script src="{{ site.baseurl }}/assets/js/theme-switcher.js"></script>
    <script src="{{ site.baseurl }}/assets/js/cookie-consent.js"></script>
    
    <!-- Analytics -->
    {% include analytics.html %}
</body>
</html>