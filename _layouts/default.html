<!DOCTYPE html>
<html lang="en" data-baseurl="{{ site.baseurl }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: https://www.google-analytics.com; font-src 'self' data:; connect-src 'self' https://api.github.com https://www.google-analytics.com https://analytics.google.com https://region1.google-analytics.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';"">
    
    <!-- Featured Image Meta Tags for Social Sharing -->
    {% if page.featured_image %}
    <meta property="og:image" content="{{ site.url }}{{ page.featured_image }}">
    <meta name="twitter:image" content="{{ site.url }}{{ page.featured_image }}">
    {% if page.featured_image_alt %}
    <meta property="og:image:alt" content="{{ page.featured_image_alt }}">
    <meta name="twitter:image:alt" content="{{ page.featured_image_alt }}">
    {% endif %}
    {% elsif page.layout == 'post' %}
    <!-- Fallback to site logo for posts without featured images -->
    <meta property="og:image" content="{{ site.url }}{{ site.logo }}">
    <meta name="twitter:image" content="{{ site.url }}{{ site.logo }}">
    <meta property="og:image:alt" content="{{ site.title }}">
    <meta name="twitter:image:alt" content="{{ site.title }}">
    {% endif %}

    <!-- SEO Meta Tags (jekyll-seo-tag handles Open Graph, Twitter Cards, etc.) -->
    {% seo %}

    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS Feed" href="{{ site.baseurl }}/feed.xml">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/main.css">
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/analytics.css">

    <!-- Structured Data (Schema.org JSON-LD) -->
    {% include structured-data.html %}
</head>
<body>
    <!-- Skip navigation link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Theme toggle button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light theme">
        <span class="theme-toggle-icon" id="theme-icon">ğŸŒ™</span>
        <span id="theme-text">Dark</span>
    </button>
    
    <h1>
        <a href="{{ site.baseurl }}/" class="site-title-link">
            <img src="{{ site.baseurl }}/assets/img/logo.webp" alt="{{ site.title }}" class="site-logo">
        </a>
    </h1>
    
    {% include navigation.html %}
    
    <!-- Mobile search icon (mobile only) -->
    <span class="mobile-search" title="Search" onclick="toggleSearch()">ğŸ”</span>
    
    <!-- Hamburger menu button (mobile only) -->
    <button class="hamburger-menu" aria-label="Toggle navigation menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>
    
    <!-- Mobile overlay -->
    <div class="sidebar-overlay"></div>
    
    <!-- Combined mobile menu -->
    <div class="combined-menu">
        <!-- Main Navigation Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Main Navigation</h3>
            <ul class="menu-items">
                <li><a href="{{ site.baseurl }}/" {% if page.url == "/" or page.url == "/index.html" %}class="active"{% endif %}><span class="menu-icon">ğŸ </span>Home</a></li>
                {% assign sorted_pages = site.pages | sort: 'title' %}
                {% for page_item in sorted_pages %}
                    {% if page_item.title and page_item.title != "Home" and page_item.title != "Search" %}
                        <li><a href="{{ site.baseurl }}{{ page_item.url }}" {% if page.url == page_item.url %}class="active"{% endif %}>
                            <span class="menu-icon">
                                {% if page_item.title == "About Me" %}ğŸ‘¤
                                {% elsif page_item.title == "Contact" %}ğŸ“§
                                {% elsif page_item.title == "Archive" %}ğŸ“
                                {% elsif page_item.title == "Category" %}ğŸ·ï¸
                                {% else %}ğŸ“„{% endif %}
                            </span>{{ page_item.title }}
                        </a></li>
                    {% endif %}
                {% endfor %}
                {% if site.posts.size > 0 %}
                    <li><a href="{{ site.baseurl }}/posts/" {% if page.url contains '/posts/' or page.layout == 'post' %}class="active"{% endif %}><span class="menu-icon">ğŸ“</span>Posts</a></li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Categories Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Categories</h3>
            <ul class="menu-items">
                {% assign categories = site.posts | map: 'categories' | join: ',' | split: ',' | uniq | sort %}
                {% for category in categories limit: 5 %}
                    {% if category != "" %}
                        {% assign category_posts = site.posts | where: 'categories', category %}
                        <li><a href="{{ site.baseurl }}/category/{{ category | slugify }}/">
                            <span class="menu-icon">ğŸ·ï¸</span>{{ category | capitalize }}
                            <span class="menu-count">{{ category_posts.size }}</span>
                        </a></li>
                    {% endif %}
                {% endfor %}
                {% if categories.size > 5 %}
                    <li><a href="{{ site.baseurl }}/category/"><span class="menu-icon">ğŸ“‚</span>View All Categories</a></li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Archives Section -->
        <div class="menu-section">
            <h3 class="menu-section-title">Archives</h3>
            <ul class="menu-items">
                {% include year-archive-counts.liquid %}
                {% for entry in year_data limit: 5 %}
                    {% assign parts = entry | split: ":" %}
                    {% assign year = parts[0] %}
                    {% assign count = parts[1] %}
                    <li><a href="{{ site.baseurl }}/archive/{{ year }}/">
                        <span class="menu-icon">ğŸ“…</span>{{ year }}
                        <span class="menu-count">{{ count }}</span>
                    </a></li>
                {% endfor %}
                {% if year_data.size > 5 %}
                    <li><a href="{{ site.baseurl }}/archive/"><span class="menu-icon">ğŸ“</span>View All Archives</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    
    <div class="site-container">
        <main class="main-content" id="main-content">
            {% unless page.url == "/" %}
                {% include breadcrumbs.html %}
            {% endunless %}
            {{ content }}
        </main>
        
        {% include sidebar.html %}
    </div>
    
    {% include footer.html %}
    
    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <span class="close">&times;</span>
        <img id="modalImage" src="" alt="">
    </div>
    
    <!-- Scripts -->
    <script src="{{ site.baseurl }}/assets/js/lazy-loading.js"></script>
    <script src="{{ site.baseurl }}/assets/js/utils.js"></script>
    <script src="{{ site.baseurl }}/assets/js/search.js"></script>
    <script src="{{ site.baseurl }}/assets/js/hamburger.js"></script>
    <script src="{{ site.baseurl }}/assets/js/theme-switcher.js"></script>
    <script src="{{ site.baseurl }}/assets/js/cookie-consent.js"></script>
    
    <!-- Conditional loading: Modal only on pages with images -->
    {% if page.layout == 'post' or page.title == 'About Me' or page.url contains '/posts/' %}
    <script src="{{ site.baseurl }}/assets/js/modal.js"></script>
    {% endif %}
    
    <!-- Conditional loading: Pagination only on posts page -->
    {% if page.title == 'All Posts' or page.url == '/posts/' %}
    <script src="{{ site.baseurl }}/assets/js/pagination.js"></script>
    {% endif %}
    
    <!-- Analytics -->
    {% include analytics.html %}
</body>
</html>