{% comment %}
Right sidebar navigation - globally managed
Automatically generates category-based post summaries
{% endcomment %}

<aside class="sidebar">

    {% comment %} Categories Section {% endcomment %}
    <div class="sidebar-section">
        <h3>Categories</h3>
        {% assign categories = site.posts | map: 'categories' | join: ',' | split: ',' | uniq | sort %}
        {% if categories.size > 0 %}
            <ul class="sidebar-categories">
                {% for category in categories %}
                    {% if category != "" %}
                        {% assign category_posts = site.posts | where: 'categories', category %}
                        <li>
                            <a href="{{ site.baseurl }}/category/#{{ category | slugify }}">
                                {{ category }} ({{ category_posts.size }})
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    {% comment %} Archives Section {% endcomment %}
    <div class="sidebar-section">
        <h3>Archives</h3>
        {% assign years = "" | split: "" %}
        {% assign year_counts = "" | split: "" %}
        {% for post in site.posts %}
            {% assign post_year = post.date | date: "%Y" %}
            {% unless years contains post_year %}
                {% assign years = years | push: post_year %}
                {% assign year_counts = year_counts | push: 0 %}
            {% endunless %}
        {% endfor %}
        
        {% for year in years %}
            {% assign count = 0 %}
            {% for post in site.posts %}
                {% assign post_year = post.date | date: "%Y" %}
                {% if post_year == year %}
                    {% assign count = count | plus: 1 %}
                {% endif %}
            {% endfor %}
            {% assign year_counts = year_counts | push: count %}
        {% endfor %}
        
        {% assign years = years | sort | reverse %}
        {% if years.size > 0 %}
            <ul class="sidebar-archives">
                {% for year in years %}
                    {% assign count = 0 %}
                    {% for post in site.posts %}
                        {% assign post_year = post.date | date: "%Y" %}
                        {% if post_year == year %}
                            {% assign count = count | plus: 1 %}
                        {% endif %}
                    {% endfor %}
                    <li>
                        <a href="{{ site.baseurl }}/archive/{{ year }}/">
                            {{ year }} ({{ count }})
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

</aside>