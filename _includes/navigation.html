{% comment %}
Dynamic navigation that auto-discovers all pages in _pages collection
Maintains dynamic nature - just add pages to _pages folder and they appear
{% endcomment %}

{% assign current_path = page.url %}
{% assign current_collection = page.collection %}

<div class="nav">
  {% comment %} Always show Home first {% endcomment %}
  <a href="{{ site.baseurl }}/" {% if current_path == "/" or current_path == "/index.html" or current_path == site.baseurl or current_path == site.baseurl | append: "/" %}class="active"{% endif %}>Home</a>
  
  {% comment %} Auto-discover all pages in _pages collection {% endcomment %}
  {% assign sorted_pages = site.pages | sort: 'title' %}
  {% for page_item in sorted_pages %}
    {% if page_item.title and page_item.title != "Home" %}
      <a href="{{ site.baseurl }}{{ page_item.url }}" {% if current_path == page_item.url %}class="active"{% endif %}>{{ page_item.title }}</a>
    {% endif %}
  {% endfor %}
  
  {% comment %} Always show Posts if there are any {% endcomment %}
  {% if site.posts.size > 0 %}
    <a href="{{ site.baseurl }}/posts/" {% if current_path contains '/posts/' or page.layout == 'post' %}class="active"{% endif %}>Posts</a>
  {% endif %}
</div>

{% comment %} Child navigation for _pages collection when viewing a page {% endcomment %}
{% if current_collection == 'pages' and site.pages.size > 1 %}
  <div class="child-nav">
    <div class="child-nav-title">Pages</div>
    <div class="child-nav-links">
      {% assign sorted_pages = site.pages | sort: 'title' %}
      {% for item in sorted_pages %}
        {% if item.title and item.title != "Home" %}
          <a href="{{ site.baseurl }}{{ item.url }}" {% if current_path == item.url %}class="active"{% endif %}>{{ item.title }}</a>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}

{% comment %} Child navigation for posts {% endcomment %}
{% if current_path contains '/posts/' or page.layout == 'post' %}
  {% if site.posts.size > 0 %}
    <div class="child-nav">
      <div class="child-nav-title">Recent Posts</div>
      <div class="child-nav-links">
        {% for post in site.posts limit: 10 %}
          <a href="{{ site.baseurl }}{{ post.url }}" {% if current_path == post.url %}class="active"{% endif %}>{{ post.title }}</a>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endif %}