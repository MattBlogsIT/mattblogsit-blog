---
layout: default
permalink: /category/:slug/
---

<script>
// Dynamic category page - gets category from URL
document.addEventListener('DOMContentLoaded', function() {
    // Get category from URL path - handle both /category/microsoft/ and /category/microsoft
    const pathParts = window.location.pathname.split('/').filter(part => part !== '');
    let categorySlug = null;
    
    // Find category in path segments
    for (let i = 0; i < pathParts.length; i++) {
        if (pathParts[i] === 'category' && i + 1 < pathParts.length) {
            categorySlug = pathParts[i + 1];
            break;
        }
    }
    
    console.log('Category page - pathname:', window.location.pathname, 'category:', categorySlug);
    
    if (!categorySlug) {
        showAllCategories();
        return;
    }
    
    // Fetch posts data and filter by category
    fetch(getBasePath() + '/search.json')
        .then(response => response.json())
        .then(data => {
            const posts = data.filter(item => item.type === 'post');
            const categoryPosts = posts.filter(post => {
                if (!post.categories) return false;
                return post.categories.some(cat => {
                    const normalizedCat = cat.toLowerCase().replace(/[^a-z0-9]/g, '-');
                    const matches = normalizedCat === categorySlug;
                    if (matches) {
                        console.log('Found matching post:', post.title, 'category:', cat, 'normalized:', normalizedCat);
                    }
                    return matches;
                });
            });
            
            displayCategoryPosts(categorySlug, categoryPosts);
        })
        .catch(error => {
            console.error('Error loading posts:', error);
            document.getElementById('category-content').innerHTML = '<p>Error loading posts.</p>';
        });
});

function getBasePath() {
    return window.location.pathname.includes('/mattblogsit-dev') ? '/mattblogsit-dev' : '';
}

function displayCategoryPosts(categorySlug, posts) {
    const categoryName = categorySlug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    const content = document.getElementById('category-content');
    
    if (posts.length === 0) {
        content.innerHTML = `
            <h1>${categoryName} Posts</h1>
            <p>No posts found in this category.</p>
            <p><a href="${getBasePath()}/posts/">← Back to All Posts</a></p>
        `;
        return;
    }
    
    let html = `
        <h1>${categoryName} Posts</h1>
        <p>${posts.length} post${posts.length > 1 ? 's' : ''} in this category:</p>
        <div class="post-list">
    `;
    
    posts.forEach(post => {
        html += `
            <article class="post-preview">
                <h3><a href="${post.url}">${post.title}</a></h3>
                <div class="post-date">${post.date}</div>
                ${post.excerpt ? `<div class="post-excerpt">${post.excerpt}</div>` : ''}
                <a href="${post.url}" class="read-more">Read more →</a>
            </article>
        `;
    });
    
    html += `
        </div>
        <p><a href="${getBasePath()}/posts/">← Back to All Posts</a></p>
    `;
    
    content.innerHTML = html;
}

function showAllCategories() {
    fetch(getBasePath() + '/search.json')
        .then(response => response.json())
        .then(data => {
            const posts = data.filter(item => item.type === 'post');
            const categories = {};
            
            posts.forEach(post => {
                if (post.categories) {
                    post.categories.forEach(cat => {
                        if (!categories[cat]) {
                            categories[cat] = 0;
                        }
                        categories[cat]++;
                    });
                }
            });
            
            let html = `
                <h1>All Categories</h1>
                <div class="category-list">
            `;
            
            Object.keys(categories).sort().forEach(category => {
                const slug = category.toLowerCase().replace(/[^a-z0-9]/g, '-');
                html += `
                    <div class="category-item">
                        <h3><a href="${getBasePath()}/category/${slug}/">${category}</a></h3>
                        <p>${categories[category]} post${categories[category] > 1 ? 's' : ''}</p>
                    </div>
                `;
            });
            
            html += `</div>`;
            document.getElementById('category-content').innerHTML = html;
        });
}
</script>

<div id="category-content">
    <p>Loading...</p>
</div>

<style>
.category-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.category-item {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f8f9fa;
}

.category-item h3 {
    margin: 0 0 10px 0;
}

.category-item h3 a {
    color: #3498db;
    text-decoration: none;
}

.category-item h3 a:hover {
    text-decoration: underline;
}

.category-item p {
    margin: 0;
    color: #666;
}
</style>