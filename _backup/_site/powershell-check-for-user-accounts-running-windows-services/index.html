<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerShell: Check for user accounts running Windows Services - Matt Blogs IT</title>
    <meta name="description" content="Recently I worked with a client to validate that if a user account were to be disabled that it wasn’t going to break any of their currently running applicati...">
    
    <link rel="stylesheet" href="/assets/css/style.css">
    <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Matt Blogs IT" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PowerShell: Check for user accounts running Windows Services | Matt Blogs IT</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="PowerShell: Check for user accounts running Windows Services" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Recently I worked with a client to validate that if a user account were to be disabled that it wasn’t going to break any of their currently running applications. You can be bitten by an accidental miss-configuration where an end-users account is running a Windows Service or possibly at a lower level in a specific application such as SQL Server jobs. Luckily with the Power of PowerShell, we can conquer the Windows Services! It is also possible to create a SQL Query or even PowerShell scripts to query SQL, but we are not covering that in this article." />
<meta property="og:description" content="Recently I worked with a client to validate that if a user account were to be disabled that it wasn’t going to break any of their currently running applications. You can be bitten by an accidental miss-configuration where an end-users account is running a Windows Service or possibly at a lower level in a specific application such as SQL Server jobs. Luckily with the Power of PowerShell, we can conquer the Windows Services! It is also possible to create a SQL Query or even PowerShell scripts to query SQL, but we are not covering that in this article." />
<link rel="canonical" href="http://0.0.0.0:4000/powershell-check-for-user-accounts-running-windows-services/" />
<meta property="og:url" content="http://0.0.0.0:4000/powershell-check-for-user-accounts-running-windows-services/" />
<meta property="og:site_name" content="Matt Blogs IT" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-09-25T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PowerShell: Check for user accounts running Windows Services" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-09-25T00:00:00-07:00","datePublished":"2014-09-25T00:00:00-07:00","description":"Recently I worked with a client to validate that if a user account were to be disabled that it wasn’t going to break any of their currently running applications. You can be bitten by an accidental miss-configuration where an end-users account is running a Windows Service or possibly at a lower level in a specific application such as SQL Server jobs. Luckily with the Power of PowerShell, we can conquer the Windows Services! It is also possible to create a SQL Query or even PowerShell scripts to query SQL, but we are not covering that in this article.","headline":"PowerShell: Check for user accounts running Windows Services","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/powershell-check-for-user-accounts-running-windows-services/"},"url":"http://0.0.0.0:4000/powershell-check-for-user-accounts-running-windows-services/"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
    <header class="site-header">
        <div class="wrapper">
            <a class="site-title" href="/">Matt Blogs IT</a>
            <nav class="site-nav">
                <a href="/">Home</a>
                <a href="/about-me/">About</a>
                <a href="/archive/">Archive</a>
                <a href="/contact-me/">Contact</a>
                <a href="/my-credentials/">Credentials</a>
            </nav>
        </div>
    </header>

    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">PowerShell: Check for user accounts running Windows Services</h1>
        <p class="post-meta">
            <time datetime="2014-09-25T00:00:00-07:00" itemprop="datePublished">
                September 25, 2014
            </time>
            
                | Categories: 
                
                    <span class="category">administrator</span>, 
                
                    <span class="category">microsoft</span>
                
            
        </p>
    </header>

    <div class="post-content" itemprop="articleBody">
        <p>Recently I worked with a client to validate that if a user account were to be disabled that it wasn’t going to break any of their currently running applications. You can be bitten by an accidental miss-configuration where an end-users account is running a Windows Service or possibly at a lower level in a specific application such as SQL Server jobs. Luckily with the Power of PowerShell, we can conquer the Windows Services! It is also possible to create a SQL Query or even PowerShell scripts to query SQL, but we are not covering that in this article.</p>

<h2 id="checking-windows-services">Checking Windows Services:</h2>

<p>The biggest concern I had was the Windows Services. It is easy enough for a junior admin to install SQL and specify their account as the Service Account, <strong>THIS IS BAD!</strong> However, with some pure PowerShell, we can perform a visual inspection, or with some minor adjustments, we could look for a service running with a specific user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-CimInstance -ComputerName (Get-ADComputer -Filter 'OperatingSystem -like "Windows Server*"' | Select -ExpandProperty Name) -Query "SELECT Name, StartName FROM Win32_Service WHERE StartName &lt;&gt; 'LocalSystem'" | ? { $_.StartName -notlike 'NT AUTHORITY*' -and $_.StartName -notlike 'NT SERVICE*' } | Select Name, StartName, PSComputerName
</code></pre></div></div>

<p>In the above example, we are using a parenthetical command along with the Get-CimInstance Cmdlet. The command that executes first is the Get-ADComputer. This command requires the ActiveDirectory module is available on your computer system. It uses the filter parameter to look for any computer that is running Windows Server (any version).</p>

<p>Then it passes those values to the Get-CimInstance, which performs an initial WQL Query, which doesn’t allow and statements. Therefore, we have to pipe it’s returned values to a where statement which continues filtering for us. The end of the command provides the service name, the user account running it, and the computer this service is on.</p>

<p>I was able to run this against the client’s environment, and within a few minutes, we knew it was safe to disable the account.</p>

    </div>

    
    <div class="post-tags">
        <strong>Tags:</strong>
        
            <span class="tag">microsoft</span>, 
        
            <span class="tag">powershell</span>, 
        
            <span class="tag">powershell-v4</span>, 
        
            <span class="tag">scripting</span>, 
        
            <span class="tag">server-2012</span>, 
        
            <span class="tag">server-2012-r2</span>, 
        
            <span class="tag">windows</span>
        
    </div>
    
</article>
        </div>
    </main>

    <footer class="site-footer">
        <div class="wrapper">
            <p>&copy; 2025 Matt Blogs IT. All rights reserved.</p>
            <p>
                
                <a href="https://github.com/mattgriffin">GitHub</a> |
                
                
                <a href="https://twitter.com/mattgriffinit">Twitter</a>
                
            </p>
        </div>
    </footer>
</body>
</html>